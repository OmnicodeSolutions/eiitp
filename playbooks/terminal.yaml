---
- name: Install terminal environment
  hosts: all
  gather_facts: no

  vars:
    topsecret_repo: "git@gitlab.com:mauriciovieira/top-secret.git"
    topsecret_path: "~/Repositories/gitlab.com/mauriciovieira/top-secret"
    vscode_settings: "templates/Library/ApplicationSupport/Code/User/settings.json"
    vscode_settings_path: "~/Library/Application Support/Code/User/"
    screenshots_path: "~/Pictures/Screenshots"

    packages:
      - ag
      - certbot
      - cmake
      - composer
      - ffmpeg
      - ghc
      - gifsicle
      - git
      - go
      - heroku
      - htop
      - hub
      - imagemagick
      - jq
      - mosh
      - parity
      - passpie
      - pyenv
      - pyenv-virtualenv
      - pyenv-virtualenvwrapper
      - shellcheck
      - wget
      - yarn

    cask_packages:
      - java
      - ngrok
      - virtualbox

    rubygems:
      - travis

    unwanted_packages:
      - docker-compose
      - docker-machine
      - htop-osx

    go_directories:
      - ~/workspace/Go/src/github.com/mauriciovieira
      - ~/workspace/Go/bin
      - ~/workspace/Go/pkg


    # todo:
    #   - rvm
    #   - nvm
    #   - yadr

  tasks:
    - name: Ensure Go directories exist
      file: path="{{ item }}" state=directory
      with_items: "{{ go_directories }}"

    - name: Ensure {{ topsecret_path }} exists
      file: path={{ topsecret_path }} state=directory

    - name: Clone / update top-secret repository
      git: repo={{ topsecret_repo }} dest="{{ topsecret_path }}" version=master

    - name: Install top-secret stuff
      shell: chdir="{{ topsecret_path }}" make install

    - name: Uninstall Homebrew packages
      homebrew: name={{ item }} state=absent
      with_items: "{{ unwanted_packages }}"

    - name: Install Homebrew packages
      homebrew: name={{ item }} state=latest
      with_items: "{{ packages }}"

    - name: Install ruby gems
      gem: name={{ item }} state=present
      with_items: "{{ rubygems }}"

    - name: Install Homebrew Cask packages
      homebrew_cask: name={{ item }} state=installed
      with_items: "{{ cask_packages }}"

    - name: Ensure {{ screenshots_path }} exists
      file: path={{ screenshots_path }} state=directory

    - name: Set screenshots location
      shell: defaults write com.apple.screencapture location {{ screenshots_path }}

    - name: Install vscode settings
      copy: src="{{ vscode_settings }}" dest="{{ vscode_settings_path }}" mode=0640

  # roles:
  #   - role: voboshi.ansible-role-nvm-macos
  #     nvm:
  #       version: v0.33.2
  #       node_version: '8.7.0'
